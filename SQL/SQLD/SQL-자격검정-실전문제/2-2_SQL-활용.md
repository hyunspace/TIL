# 2-2. SQL 활용

1. 표준 조인
2. 집합 연산자
3. 계층형 질의와 셀프 조인
4. 서브쿼리
5. 그룹 함수
6. 윈도우 함수
7. DCL
8. 절차형 SQL

<br/>

## 표준 조인

### NATURAL JOIN, USING

* 중복된 컬럼이 하나만 출력
* 중복된 컬럼이 제일 앞에 등장

### OUTER JOIN

* 오라클에서는 OUTER JOIN의 조건에 (+) 표시

* **LEFT OUTER JOIN**

  * `A LEFT OUTER JOIN B`

    👉 A를 기준으로 테이블을 만드는데, `ON`조건에 맞다면 B의 값을 갖고 와서 A에 넣어주고, 아니라면 모두 null

- 조인순서; FROM A, B, C

  1. A, B 먼저 조인하고 결과 테이블과 C를 조인

<br/>

## 집합 연산자⭐️

|  집합 연산자   |           의미            |                  정렬 작업                   |
| :------------: | :-----------------------: | :------------------------------------------: |
|     UNION      |          합집합           |                      O                       |
|   INTERSECT    |          교집합           |                      O                       |
| MINUS (EXCEPT) |          차집합           |                      O                       |
|   UNION ALL    | 단순 더하기<br />(중복 O) | X<br />빠르다<br />but 중복데이터 존재<br /> |

* UNION vs UNION ALL

  * 후자가 빠르다
  * 중복 제거 안 해도 되니까!

* UNION ALL 하고 UNION을 하면

  👉 중복으로 존재했던 데이터가 사라진다!

<br/>

## 계층형 질의와 셀프 조인

<br/>

## 서브쿼리⭐️

|          |                   서브쿼리                    |
| :------: | :-------------------------------------------: |
|  SELECT  |                    SCALAR                     |
|   FROM   | INLINE VIEW<br /> 메인 쿼리의 컬럼 사용 가능! |
|  WHERE   |     거의 모든 서브 쿼리 => 중첩 서브쿼리      |
| GROUP BY |                       X                       |
|  HAVING  |     거의 모든 서브 쿼리 => 중첩 서브쿼리      |
| ORDER BY |                    SCALAR                     |

<br/>

## 그룹함수 ⭐️⭐️⭐️

> 결과값을 주고 어떤 함수를 사용한 건지 질문
>
> 1.  null 다 찾고
> 2.  총합행이 있는가 => 있다면 roll up 또는 cube
>     1. 있다면 roll up 또는 cube
>        * 둘 다 결과가 있다면(행의 수가 많아 보이면) cube
>        * 계층화 되어 있다면(행의 수가 적어 보이면) roll up
>     2. 없다면 grouping sets

### ROLLUP

> GROUP BY ROLLUP(A, B)

* 순서가 영향을 미친다
* 한 개부터 N개의 컬럼을 넣을 수 있다
* A, B만 넣으면 A별 소계, 총 합이 나온다

### CUBE

> GROUP BY CUBE(A, B)

* 순서가 영향을 안 미친다!
* 모둔 경우의 수를 다 보여주니까, 행의 수가 더 많아 보인다

### GROUPING SETS

<br/>

## 윈도우 함수(순위 함수)

* 함수 **OVER (PARTITION BY a ORDER BY b)**
  * ORDER BY는 항상 마지막에 실행 되므로, 정렬을 먼저 하고 일련 번호/순위를 매길 때 사용
  * PARTION BY는 그룹별로 일련 번호/순위 매길 때 사용!

#### ROW_NUMBER

* 일련 번호 붙이기

#### RANK

* 등수를 보여줌
* 동일 점수가 있다면 같은 순위, 그 다음 사람은 +n만큼
  * 1등, 2등, 3등 2명, 5등, ...
  * 이게 싫다면 **DENSE_RANK**

<br/>

## 절차형 SQL

* PL/SQL의 특징
  * 블록 구조 👉 각 기능별로 모듈화 가능
  * 변수, 상수 등을 선언하여 SQL문장 간 값을 교환
  * IF, LOOP 등 절차형 언어를 사용
  * DBMS 정의 에러나 사용자 정의 에러를 정의하여 사용 가능
  * Oracle에 내장 👉 오라클과 PL/SQL 지원하는 어떤 서버로도 옮길 수 있음
  * 응용 프로그램의 성능 향상
  * 여러 SQL문장을 블록으로 묶고, 한번에 블록 전부를 서버로 보냄 👉 통신량 줄일 수 있음
